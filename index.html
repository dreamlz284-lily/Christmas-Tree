<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift from Mengjie</title>
    <link href="https://fonts.googleapis.com/css2?family=Pinyon+Script&family=Parisienne&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; touch-action: none; }
        canvas { display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .fancy-font { font-family: 'Pinyon Script', cursive; }
        .greeting-font { font-family: 'Parisienne', cursive; }
    </style>
</head>
<body class="bg-black">
    <div id="container" class="relative w-full h-screen overflow-hidden cursor-pointer">
        <canvas id="treeCanvas"></canvas>
        
        <div id="uiOverlay" class="absolute inset-0 flex flex-col pointer-events-none">
            <div class="h-1/3 flex items-center justify-center pt-8 transition-opacity duration-700" id="topHeader">
                <h2 class="fancy-font text-4xl md:text-7xl bg-clip-text text-transparent bg-gradient-to-b from-yellow-50 via-yellow-400 to-yellow-800 animate-pulse text-center px-4">
                    Gift from Mengjie
                </h2>
            </div>

            <div class="mt-auto h-1/2 flex flex-col items-center justify-center pb-12">
                <div id="clickHint" class="text-white/30 uppercase tracking-[0.4em] text-xs animate-bounce mb-8">Click to Open</div>
                
                <div id="treeContent" class="opacity-0 translate-y-10 transition-all duration-1000 text-center px-6">
                    <h1 class="fancy-font text-5xl md:text-7xl mb-4 bg-clip-text text-transparent bg-gradient-to-b from-yellow-100 via-yellow-400 to-yellow-800">
                        Merry Christmas
                    </h1>
                    <div class="h-12 overflow-hidden">
                        <p id="greetingText" class="greeting-font text-xl md:text-3xl text-white/90 italic transition-all duration-500"></p>
                    </div>
                    <p class="fancy-font text-xl md:text-2xl mt-4 text-yellow-600">From Mengjie</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('treeCanvas');
        const ctx = canvas.getContext('2d', { alpha: false }); // 优化：关闭透明通道提升性能
        const container = document.getElementById('container');
        const GREETINGS = [
            "Wishing you a joyful Christmas!",
            "Success and health in the New Year.",
            "May your holidays be bright and happy.",
            "Warmest wishes to you and your family."
        ];

        let w, h, particles = [], snow = [], isTree = false, tProg = 0, gIdx = 0;
        let rotY = 0;

        // 核心配置
        const P_COUNT = 8000; // 优化粒子数量确保丝滑
        const S_COUNT = 200;

        function init() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            
            particles = [];
            const boxSize = Math.min(w, h) * 0.28;
            const treeHeight = h * 0.7;
            const treeBase = Math.min(w, h) * 0.45;

            for (let i = 0; i < P_COUNT; i++) {
                // 礼盒（立方体）
                let bx, by, bz, side = Math.floor(Math.random() * 6);
                let u = (Math.random()-0.5)*boxSize, v = (Math.random()-0.5)*boxSize, d = boxSize/2;
                if(side==0){bx=d;by=u;bz=v} else if(side==1){bx=-d;by=u;bz=v} else if(side==2){bx=u;by=d;bz=v}
                else if(side==3){bx=u;by=-d;bz=v} else if(side==4){bx=u;by=v;bz=d} else {bx=u;by=v;bz=-d}

                // 圣诞树（圆锥）
                const ty = (Math.random() - 0.5) * treeHeight;
                const radProg = (ty + treeHeight / 2) / treeHeight;
                const r = Math.sqrt(Math.random()) * (treeBase / 2) * radProg;
                const ang = Math.random() * Math.PI * 2;

                particles.push({
                    bx, by, bz,
                    tx: r * Math.cos(ang), ty, tz: r * Math.sin(ang),
                    c1: [220, 30, 30], // 红
                    c2: [30, Math.random()*100+155, 70], // 绿
                    s: Math.random() * 1.5 + 0.5
                });
            }

            snow = Array.from({length: S_COUNT}, () => ({
                x: Math.random() * w, y: Math.random() * h, 
                v: Math.random() * 2 + 1, s: Math.random() * 2
            }));
        }

        function render() {
            // 使用纯黑色覆盖，避免透明度计算延迟
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, w, h);
            
            // 物理更新
            rotY += 0.01;
            if (isTree && tProg < 1) tProg += 0.02; // 极速变换

            const cosY = Math.cos(rotY), sinY = Math.sin(rotY);
            const ease = tProg * tProg * (3 - 2 * tProg);

            // 批量绘制提升性能
            ctx.globalCompositeOperation = 'lighter';
            for (let i = 0; i < P_COUNT; i++) {
                const p = particles[i];
                
                // 插值计算
                const px = p.bx + (p.tx - p.bx) * ease;
                const py = p.by + (p.ty - p.by) * ease;
                const pz = p.bz + (p.tz - p.bz) * ease;

                // 旋转与投影
                const rx = px * cosY - pz * sinY;
                const rz = px * sinY + pz * cosY;
                const sc = 800 / (800 + rz);
                
                const x = rx * sc + w/2;
                const y = py * sc + h/2;

                // 颜色平滑过渡
                const r = Math.floor(p.c1[0] + (p.c2[0] - p.c1[0]) * ease);
                const g = Math.floor(p.c1[1] + (p.c2[1] - p.c1[1]) * ease);
                const b = Math.floor(p.c1[2] + (p.c2[2] - p.c1[2]) * ease);

                ctx.fillStyle = `rgb(${r},${g},${b})`;
                ctx.fillRect(x, y, p.s * sc, p.s * sc);
            }

            // 雪花仅在树阶段显示
            if (tProg > 0.1) {
                ctx.fillStyle = `rgba(255,255,255,${tProg})`;
                for (let s of snow) {
                    s.y += s.v;
                    if (s.y > h) s.y = -10;
                    ctx.beginPath();
                    ctx.arc(s.x, s.y, s.s, 0, 7);
                    ctx.fill();
                }
            }

            requestAnimationFrame(render);
        }

        container.addEventListener('mousedown', () => {
            if (!isTree) {
                isTree = true;
                document.getElementById('topHeader').style.opacity = '0';
                document.getElementById('clickHint').style.display = 'none';
                
                setTimeout(() => {
                    const content = document.getElementById('treeContent');
                    content.classList.remove('opacity-0', 'translate-y-10');
                    updateText();
                }, 500);
            }
        });

        function updateText() {
            const el = document.getElementById('greetingText');
            el.innerText = GREETINGS[gIdx];
            gIdx = (gIdx + 1) % GREETINGS.length;
            setTimeout(updateText, 4000);
        }

        window.addEventListener('resize', init);
        init();
        render();
    </script>
</body>
</html>
